# Creates a new tag in one of our existing tag categories across all vCenters at the same time.

$vcs = $env:vcs
$vcs = $vcs.Split(',')
$tagcat = $env:tagcat
$tagname = $env:tagname

$VCPassword = ConvertTo-SecureString "$($ENV:vcpass)" -AsPlainText -Force
$vccreds = New-Object System.Management.Automation.PSCredential ("$ENV:vcuser", $vcPassword)

foreach ($vc in $vcs){
	Connect-VIServer $vc -Credential $vccreds

	$tagcatobj = Get-TagCategory -Name $tagcat
	New-Tag -Category $tagcatobj -Name $tagname -ErrorAction:SilentlyContinue
	disconnect-viserver $vc -confirm:$false		
}
